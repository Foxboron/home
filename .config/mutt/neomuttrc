set editor = "vim +$" 
set my_name = "Morten Linderud"
set header_cache = "~/.cache/mutt"
set imap_check_subscribed
set imap_keepalive = 520
unset imap_passive
set mailcap_path = ~/.config/mutt/mailcap
set signature = ~/.config/mutt/signature

# Default
set realname = 'Morten Linderud'
set from = morten@linderud.pw
set sendmail  = "/usr/bin/msmtp -a linderud"
set send_charset="us-ascii:utf-8"

set check_new=yes       # Check for new messages in maildir
set mail_check=5        # Check mail every 5 seconds
set mail_check_stats = yes
set timeout=5           # Time out 5 seconds after last keypress to check for mail
set forward_quote=no    # Don't quote forwards
set help=no	            # Disable the help header
set indent_string="> "  # Proper quoting
set read_inc=1000
set beep_new=yes
set write_inc=1000
set followup_to=yes

set charset=utf-8
set send_charset=utf-8

alternative_order text/plain text/html text/enriched
auto_view text/html

set reverse_name
set reverse_realname
set pager_format="$from: -%Z- %C/%m: %-20.20n   %s%*  -- (%P)"
set status_format="$from: %f (%s/%S)"
set sort=threads
set sort_aux=last-date-received

set quit=no
set move=no
set confirmappend=no
set collapse_unread=no
set uncollapse_jump=yes

set fast_reply=yes
#set smart_wrap=yes

set sidebar_sort_method="path"
set sidebar_width = 20
set sidebar_visible = yes
set sidebar_folder_indent = yes
set sidebar_format= '%B%*  %N'
#set sidebar_short_path = yes
set mail_check_stats = yes
set pager_index_lines=10

macro index b '<enter-command>toggle sidebar_visible<enter><refresh>'
macro pager b '<enter-command>toggle sidebar_visible<enter><redraw-screen>'

bind index,pager \CP sidebar-prev
bind index,pager \CN sidebar-next
bind index,pager \CO sidebar-open

bind index,pager R  group-reply
bind index <space>  collapse-thread
bind index -        collapse-all

bind index,pager   \t          next-unread
bind index,pager  ,\t      previous-unread
bind index,pager u        sync-mailbox

# imap
#set imap_user="morten@linderud.pw"
#set ssl_verify_host=yes
#set imap_pass=`pass mail/morten@linderud.pw`
#set folder="imaps://linderud.pw/"
#set spoolfile=+INBOX
#set record=+Sent
#set postponed=+Drafts

set use_from = yes
set envelope_from
set hidden_host
set ssl_force_tls = yes
set ssl_starttls = yes

set crypt_replyencrypt = yes
# set crypt_use_gpgme 
set pgp_use_gpg_agent = yes
set pgp_default_key = "0x9FECBE16"
set pgp_sign_as = "0x9FECBE16!"
set pgp_timeout = 20

# Alias
set alias_file= ~/.config/mutt/muttrc.d/aliases
set sort_alias= alias
set reverse_alias=yes

macro index,pager D \
    "<save-message>+Trash<enter>" \
    "mark message as Junk"

macro index,pager S \
    "<save-message>+Spam<enter>" \
    "mark message as Spam"

macro index,pager A \
    "<save-message>+Archive<enter>" \
    "mark message as Archive"

macro index,pager I \
    "<save-message>+Important<enter>" \
    "mark message as Important"

macro pager,index ,g "<pipe-message>~/.config/mutt/scripts/open_ml_url.py<return>" "Open GMAME link"
macro pager,index ,s "<pipe-message>~/.config/mutt/scripts/security_tracker.py<return>" "Open security.archlinux.org link"

folder-hook . "exec collapse-all"
message-hook . "source ~/.config/mutt/account.d/linderud"
message-hook "~C morten@linderud.pw" "source ~/.config/mutt/account.d/linderud"
message-hook "~C @archlinux.org" "source ~/.config/mutt/account.d/archlinux"
message-hook "~C @uib.no" "source ~/.config/mutt/account.d/uib"
message-hook "~C @student.uib.no" "source ~/.config/mutt/account.d/uib"
macro pager,index ,a ":source ~/.config/mutt/account.d/archlinux\n"
macro pager,index ,l ":source ~/.config/mutt/account.d/linderud\n"
macro pager,index ,u ":source ~/.config/mutt/account.d/uib\n"

source /home/fox/.config/mutt/muttrc.d/aliases
source /home/fox/.config/mutt/muttrc.d/colors
source /home/fox/.config/mutt/muttrc.d/ignores
source /home/fox/.config/mutt/muttrc.d/gpg.rc
#source /usr/share/doc/neomutt/vim-keys/vim-keys.rc



set mbox_type = Maildir
set header_cache = ~/.cache/neomutt
set message_cachedir = $header_cache
set folder = ~/mail/velox
set nm_default_uri = "notmuch:///home/fox/mail"
set spoolfile="+INBOX"
set record=+Sent
set postponed=+Drafts
set virtual_spoolfile = no
set nm_query_type = messages
set nm_record = yes
set nm_record_tags = "-inbox,archive,me"
set nm_query_window_current_position = 1

mailboxes `find ~/mail/ -type d -name cur -printf '%h '`

virtual-mailboxes \
    "inbox"         "notmuch://?query=tag:inbox"\
    "archive"       "notmuch://?query=tag:archive"\
    "sent"          "notmuch://?query=tag:sent"\
    "spam"          "notmuch://?query=tag:spam"\
    "junk"          "notmuch://?query=tag:junk"\
    "archlinux"     "notmuch://?query=tag:archlinux"\
    "aur"           "notmuch://?query=tag:aur"\
    "aurweb"        "notmuch://?query=tag:aurweb"\
    "efn"           "notmuch://?query=tag:efn"\
    "qutebrowser"   "notmuch://?query=tag:qutebrowser"\
    "oss-security"  "notmuch://?query=tag:oss-security"\
    "github"        "notmuch://?query=tag:github"\
    "tg"            "notmuch://?query=tag:tg"\

# Unsure
tag-transforms "attachment" "@" \
               "encrypted"  "" \
               "signed"     "✎" \
               "replied"	"↻" \
                "sent"		"➥" \
                "sent"		"+" \
                "attachment" "⎘"

tag-formats "attachment" "GA" \
            "encrypted"  "GE" \
            "signed"     "GS" \
            "replied" "GR" \
            "sent"    "Gs" \
            "list"    "Gl" \
            "attachment" "Ga"

bind index,pager X change-vfolder
bind index,pager B sidebar-toggle-virtual
bind index,pager + entire-thread
bind index,pager / vfolder-from-query
bind index < vfolder-window-backward
bind index > vfolder-window-forward

set index_format="%Z %?GT?%GT& ?%?Ga?%Ga& ?%?GA?%GA& ? %<[y?%<[m?%<[d?%[ %H:%M]&%[%a %d]>&%[%b %d]>&%[%m/%y ]> │ %-15.15L │ %s"
