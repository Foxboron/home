#!/usr/bin/bash
set -e

resolvectl --json=short --type=PTR query "$1" | jq -r '.name' | \
while read -r ptr; do
	resolvectl --json=short --type=SRV query "$ptr" | jq -r '.name'
done  | \
while read -r srv; do
	IP=$(resolvectl --json=short --type=A query "$srv" | jq -r '.address | join(".")')
	NAME=$(curl -s -k "https://$IP:8443/setup/eureka_info?options=detail" | jq -r '.name')
	printf "%s\t%s\n" "$IP" "$NAME"
done
